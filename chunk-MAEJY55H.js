import{a as w}from"./chunk-7EMTRYHG.js";import{$a as o,Ad as C,Bd as v,Dd as x,Fd as S,Q as f,T as y,Z as c,a as d,la as p,qc as u,va as l,yd as b}from"./chunk-DGTG4CQ7.js";function h(n,a){let r=!a?.manualCleanup;r&&!a?.injector&&p(h);let t=r?a?.injector?.get(l)??c(l):null,e;a?.requireSync?e=o({kind:0}):e=o({kind:1,value:a?.initialValue});let s=n.subscribe({next:i=>e.set({kind:1,value:i}),error:i=>{if(a?.rejectErrors)throw i;e.set({kind:2,error:i})}});return t?.onDestroy(s.unsubscribe.bind(s)),u(()=>{let i=e();switch(i.kind){case 1:return i.value;case 2:throw i.error;case 0:throw new f(601,"`toSignal()` called with `requireSync` but `Observable` did not emit synchronously.")}})}var Q=(()=>{class n{constructor(){this._firestore=c(b),this._storage=c(w),this._collectionMenu=x(this._firestore,"menu"),this.cartItemsCount=o(0),this.totalPrice=o(0),this.cartItems=o([]),this.getMenu=h(C(this._collectionMenu,{idField:"id"}),{initialValue:[]}),this.cartItems.set(this.getCartItems()),this.cartItemsCount.set(this.getTotalItems()),this.totalPrice.set(this.getTotalPrice())}get cartItemsValue(){return this.cartItems()}getCartItemsCount(){return u(()=>this.cartItemsCount())}getTotalPriceSignal(){return u(()=>this.totalPrice())}getItemById(r){let t=S(this._firestore,`menu/${r}`);return v(t,{idField:"id"})}getTotalItems(){return this.getCartItems().reduce((t,e)=>t+e.quantity,0)}getTotalPrice(){return this.getCartItems().reduce((t,e)=>t+e.price*e.quantity,0)}getCartItems(){let r=localStorage.getItem("cart");return r?JSON.parse(r):[]}getCartItemById(r){return this.getCartItems().find(e=>e.id===r)}getCartItemsToOrder(){return JSON.parse(localStorage.getItem("cart")||"[]").map(t=>({id:t.id,name:t.name,quantity:t.quantity,category:t.category,price:t.price,additionalInstructions:t.additionalInstructions}))}getQuantity(r){let e=this.getCartItems().find(s=>s.id===r);return e?e.quantity:0}saveCartItems(r){localStorage.setItem("cart",JSON.stringify(r)),this.cartItems.set(r),this.cartItemsCount.set(this.getTotalItems()),this.totalPrice.set(this.getTotalPrice())}addToCart(r,t,e,s,i,I,j){let m=this.cartItemsValue,g=m.find(q=>q.id===r);g?g.quantity+=I:m.push({id:r,name:t,description:e,category:s,price:i,image:"",quantity:I,additionalInstructions:j}),this.saveCartItems(m)}updateCartItemsWithImage(){let r=this.getMenu(),t=this.cartItemsValue;t.forEach(e=>{let s=r.find(i=>i.id===e.id);s&&(e.image=s.image)}),this.saveCartItems(t)}updateCartItem(r){let t=this.getCartItems(),e=t.findIndex(s=>s.id===r.id);e!==-1&&(t[e]=d(d({},t[e]),r),this.saveCartItems(t))}deleteCartItem(r){let t=this.getCartItems(),e=t.findIndex(s=>s.id===r);e!==-1&&(t.splice(e,1),this.saveCartItems(t))}clearCart(){localStorage.removeItem("cart"),this.cartItems.set([]),this.cartItemsCount.set(0),this.totalPrice.set(0)}incrementQuantity(r){let t=this.getCartItems(),e=t.find(s=>s.id===r);e&&(e.quantity+=1,this.saveCartItems(t))}decrementQuantity(r){let t=this.getCartItems(),e=t.find(s=>s.id===r);if(e){if(e.quantity=Math.max(0,e.quantity-1),e.quantity===0){let s=t.indexOf(e);s>-1&&t.splice(s,1)}this.saveCartItems(t)}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=y({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();export{Q as a};
