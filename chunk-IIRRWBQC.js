import{c as se,d as pe,e as de,f as ce}from"./chunk-Y33BJ4BU.js";import{l as me}from"./chunk-MW7XTW3W.js";import{a as re}from"./chunk-OBGG7FEQ.js";import{b as k,c as b,e as D,f as j,j as V,m as A,n as U,q as P,s as R}from"./chunk-EMSCLC7B.js";import{i as ne,u as le,v as ae}from"./chunk-ADTXEYO7.js";import{$a as E,Ia as c,Oa as f,Qa as s,S as J,Ta as g,Tb as w,Vc as Q,Y as d,Yc as X,Za as n,_a as o,a as _,aa as M,b as $,db as H,dd as Y,e as z,eb as v,fb as u,fc as K,fd as Z,id as ee,jd as te,ka as G,kd as N,la as O,nc as I,ob as a,pb as F,pd as oe,qb as C,qd as ie,wb as T,xb as y,ya as l,za as W}from"./chunk-4V4LRF2E.js";var fe=z(re());var q=()=>({"border-width":"1px"});function he(t,p){if(t&1&&(n(0,"div",16),a(1),o()),t&2){let e=u();l(),C(" ",e.getErrorMessage("name")," ")}}function ge(t,p){if(t&1&&(n(0,"div",16),a(1),o()),t&2){let e=u();l(),C(" ",e.getErrorMessage("role")," ")}}function Ee(t,p){if(t&1&&(n(0,"div",16),a(1),o()),t&2){let e=u();l(),C(" ",e.getErrorMessage("email")," ")}}function ve(t,p){if(t&1&&(n(0,"div",16),a(1),o()),t&2){let e=u(2);l(),C(" ",e.getErrorMessage("password")," ")}}function xe(t,p){if(t&1&&(n(0,"div",3)(1,"label",17),a(2,"Contrase\xF1a"),o(),E(3,"input",18),f(4,ve,2,1,"div",6),o()),t&2){let e,i=u();l(3),g(y(3,q)),l(),s("ngIf",((e=i.employeeForm.get("password"))==null?null:e.invalid)&&((e=i.employeeForm.get("password"))==null?null:e.touched))}}var L=(()=>{class t{constructor(e){this.fb=e,this.roles=[{name:"ADMIN"},{name:"TI"},{name:"CAJA"},{name:"MESERO"}],this.empService=d(B),this._selectedUser=c(null),this.selectedUser=w(()=>this._selectedUser()),this.employeeForm=this.fb.group({name:["",b.required],email:["",[b.required,b.email]],role:["",b.required],password:[""]})}ngOnInit(){this.empService.selectedUser()&&(this._selectedUser.set(this.empService.selectedUser()),this.employeeForm.patchValue(_({},this.empService.selectedUser())))}getErrorMessage(e){let i=this.employeeForm.get(e);return i?.hasError("required")?"Este campo es requerido":e==="email"&&i?.hasError("email")?"Email no v\xE1lido":""}saveEmployee(){if(this.employeeForm.valid){if(this.empService.selectedUser())this.empService.updateEmployee(this.employeeForm.value);else{if(!this.employeeForm.get("password")?.value){fe.default.fire({icon:"error",title:"Error",text:"La contrase\xF1a es requerida"});return}this.empService.addEmployee(this.employeeForm.value,this.employeeForm.get("password")?.value)}this.empService.closeModal()}}closeModal(){this.empService.closeModal()}static{this.\u0275fac=function(i){return new(i||t)(W(P))}}static{this.\u0275cmp=M({type:t,selectors:[["app-employee-modal"]],standalone:!0,features:[T],decls:25,vars:15,consts:[[1,"custom-dialog","w-full","py-4","h-full","nunito-regular","flex","flex-col","justify-between"],[1,"p-fluid","flex","flex-col","gap-5",3,"formGroup"],[1,"grid","w-full","gap-4"],[1,"p-field","col-span-6","flex","flex-col"],["for","employeeName"],["id","employeeName","type","text","pInputText","","formControlName","name",1,"border-c-gray-100","rounded-md","py-2","px-1","focus:border-orange-500","focus:shadow-md","focus:shadow-orange-300","focus:outline-none","focus:ring-0","outline-none"],["class","p-error",4,"ngIf"],["for","employeeRole"],["formControlName","role","optionLabel","name","optionValue","name","styleClass","border-c-gray-100 rounded-md focus:border-orange-500 focus:shadow-md focus:shadow-orange-300 focus:outline-none focus:ring-0 outline-none",3,"options"],["for","employeeEmail"],["id","employeeEmail","type","email","pInputText","","formControlName","email",1,"border-c-gray-100","rounded-md","py-2","px-1","focus:border-orange-500","focus:shadow-md","focus:shadow-orange-300","focus:outline-none","focus:ring-0","outline-none"],["class","p-field col-span-6 flex flex-col",4,"ngIf"],[1,"ui-dialog-footer"],[1,"flex","justify-end","gap-4","mt-8","mb-3"],[1,"bg-red-500","text-white","px-4","py-2","rounded-md",3,"click"],[1,"bg-green-500","text-white","px-4","py-2","rounded-md",3,"click"],[1,"p-error"],["for","employeePassword"],["id","employeePassword","type","password","pInputText","","formControlName","password",1,"border-c-gray-100","rounded-md","py-2","px-1","focus:border-orange-500","focus:shadow-md","focus:shadow-orange-300","focus:outline-none","focus:ring-0","outline-none"]],template:function(i,r){if(i&1&&(n(0,"div",0)(1,"form",1)(2,"div",2)(3,"div",3)(4,"label",4),a(5,"Nombre"),o(),E(6,"input",5),f(7,he,2,1,"div",6),o(),n(8,"div",3)(9,"label",7),a(10,"Rol"),o(),E(11,"p-dropdown",8),f(12,ge,2,1,"div",6),o(),n(13,"div",3)(14,"label",9),a(15,"Email"),o(),E(16,"input",10),f(17,Ee,2,1,"div",6),o(),f(18,xe,5,4,"div",11),o()(),n(19,"div",12)(20,"div",13)(21,"button",14),v("click",function(){return r.closeModal()}),a(22,"Cancelar"),o(),n(23,"button",15),v("click",function(){return r.saveEmployee()}),a(24,"Guardar"),o()()()()),i&2){let m,h,x;l(),s("formGroup",r.employeeForm),l(5),g(y(12,q)),l(),s("ngIf",((m=r.employeeForm.get("name"))==null?null:m.invalid)&&((m=r.employeeForm.get("name"))==null?null:m.touched)),l(4),g(y(13,q)),s("options",r.roles),l(),s("ngIf",((h=r.employeeForm.get("role"))==null?null:h.invalid)&&((h=r.employeeForm.get("role"))==null?null:h.touched)),l(4),g(y(14,q)),l(),s("ngIf",((x=r.employeeForm.get("email"))==null?null:x.invalid)&&((x=r.employeeForm.get("email"))==null?null:x.touched)),l(),s("ngIf",!r.selectedUser())}},dependencies:[I,K,pe,se,R,V,k,D,j,A,U]})}}return t})();var S=z(re());var B=(()=>{class t{constructor(){this.dialogService=d(me),this.auth=d(Q),this.firestore=d(Y),this.selectedUser=c(null)}getEmployees(){return Z(ee(this.firestore,"employees"),{idField:"id"})}openAddEmployeeModal(){this.ref=this.dialogService.open(L,{header:"Agregar usuario",modal:!0,keepInViewport:!0,width:"80%",style:{"max-height":"80%",height:"auto"},contentStyle:{overflow:"auto"}})}openEditEmployeeModal(){this.ref=this.dialogService.open(L,{header:"Editar usuario",modal:!0,keepInViewport:!0,width:"80%",style:{"max-height":"80%",height:"auto"},contentStyle:{overflow:"auto"}}),this.ref.onClose.subscribe(e=>{this.selectedUser.set(null)})}closeModal(){this.ref.close()}deleteEmployee(e){S.default.fire({title:`\xBFEst\xE1s seguro de eliminar el empleado ${e.name}?`,text:"No podr\xE1s revertir esta acci\xF3n",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"S\xED, eliminar",cancelButtonText:"Cancelar"}).then(i=>{if(i.isConfirmed)try{let r=N(this.firestore,"employees",e.id);te(r).then(()=>{S.default.fire("Eliminado","El empleado ha sido eliminado","success")})}catch{S.default.fire("Error","Ocurri\xF3 un error al eliminar el empleado","error")}})}addEmployee(e,i){let r={email:e.email,name:e.name,role:e.role};X(this.auth,r.email,i).then(m=>{let h=m.user.uid,x=N(this.firestore,"employees",h);return oe(x,$(_({},r),{id:h}))}).catch(m=>{S.default.fire("Error","Ocurri\xF3 un error al agregar el empleado","error")})}updateEmployee(e){let i=N(this.firestore,"employees",e.id);return ie(i,_({},e))}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=J({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var _e=()=>({"border-width":"1px"}),Ce=()=>[5,10,20];function we(t,p){t&1&&(n(0,"div",10),a(1," Empleados "),o())}function be(t,p){t&1&&(n(0,"tr")(1,"th",11),a(2,"Email"),o(),n(3,"th",11),a(4,"Nombre"),o(),n(5,"th",11),a(6,"Rol"),o(),n(7,"th",11),a(8,"Acciones"),o()())}function Se(t,p){if(t&1){let e=H();n(0,"tr")(1,"td",11),a(2),o(),n(3,"td",11),a(4),o(),n(5,"td",11),a(6),o(),n(7,"td")(8,"div",12)(9,"p-button",13),v("onClick",function(){let r=G(e).$implicit,m=u();return O(m.openEditEmployeeModal(r))}),o(),n(10,"p-button",14),v("onClick",function(){let r=G(e).$implicit,m=u();return O(m.deleteEmployee(r))}),o()()()()}if(t&2){let e=p.$implicit;l(2),F(e.email),l(2),F(e.name),l(2),F(e.role)}}function Me(t,p){t&1&&(n(0,"div",15)(1,"div",16),a(2,"No se encontraron empleados"),o()())}var tt=(()=>{class t{constructor(){this.empService=d(B),this.fb=d(P),this._employees=c([]),this.employees=w(()=>this._employees()),this.filteredEmployees=c([]),this._selectedEmployee=c(null),this.selectedEmployee=w(()=>this._selectedEmployee()),this.loadingEmployees=c(!1),this.searchForm=this.fb.group({query:[""]})}ngOnInit(){this.getEmployees(),this.searchForm.get("query")?.valueChanges.subscribe(e=>{this.filterEmployees(e)})}getEmployees(){this.loadingEmployees.set(!0),this.empService.getEmployees().subscribe(e=>{this._employees.set(e),this.filteredEmployees.set(e)}),this.loadingEmployees.set(!1)}filterEmployees(e){let i=this.employees().filter(r=>r.name.toLowerCase().includes(e.toLowerCase()));this.filteredEmployees.set(i)}openAddEmployeeModal(){this.empService.openAddEmployeeModal()}openEditEmployeeModal(e){this.empService.selectedUser.set(e),this.empService.openEditEmployeeModal()}deleteEmployee(e){this.empService.deleteEmployee(e.id)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=M({type:t,selectors:[["app-users"]],standalone:!0,features:[T],decls:10,vars:11,consts:[[1,"w-full","h-full","bg-white"],[1,"flex","justify-center","items-center","gap-4","p-4","sticky","top-0","bg-transparent","z-10"],["rounded","true","icon","pi pi-plus","styleClass","mb-4 bg-blue-500 text-white",3,"onClick"],[1,"w-full","h-16","flex","justify-center","items-center","py-4","my-5",3,"formGroup"],["type","text","id","query","placeholder","Buscar empleados...","pInputText","","formControlName","query",1,"w-2/3","border-c-gray-100","rounded-md","py-2","px-1","focus:border-orange-500","focus:shadow-md","focus:shadow-orange-300","focus:outline-none","focus:ring-0","outline-none"],["showPaginator","true","paginatorPosition","bottom",3,"value","paginator","rows","rowsPerPageOptions","responsive","showCurrentPageReport"],["pTemplate","caption",1,"w-full","h-auto"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage",1,"!w-full","flex","justify-center","items-center"],[1,"flex","w-full","items-center","justify-center","text-2xl"],[1,"text-center"],[1,"flex","gap-4","items-center","justify-center"],["pTooltip","Editar empleado","icon","pi pi-pencil","styleClass","bg-c-orange-100 rounded-full text-white px-4 py-3",3,"onClick"],["pTooltip","Eliminar empleado","icon","pi pi-trash","styleClass","bg-red-500 rounded-full text-white px-4 py-3",3,"onClick"],[1,"!w-full","flex","justify-center","items-center"],[1,"text-center","text-xl","!w-full","flex","align-center","justify-center"]],template:function(i,r){i&1&&(n(0,"div",0)(1,"div",1)(2,"p-button",2),v("onClick",function(){return r.openAddEmployeeModal()}),o()(),n(3,"form",3),E(4,"input",4),o(),n(5,"p-table",5),f(6,we,2,0,"ng-template",6)(7,be,9,0,"ng-template",7)(8,Se,11,3,"ng-template",8)(9,Me,3,0,"ng-template",9),o()()),i&2&&(l(3),s("formGroup",r.searchForm),l(),g(y(9,_e)),l(),s("value",r.filteredEmployees())("paginator",!0)("rows",10)("rowsPerPageOptions",y(10,Ce))("responsive",!0)("showCurrentPageReport",!0))},dependencies:[I,ae,le,ne,ce,de,R,V,k,D,j,A,U],encapsulation:2})}}return t})();export{tt as EmployeesComponent};
