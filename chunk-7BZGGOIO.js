import{c as g}from"./chunk-UKB7KSO2.js";import{a as k}from"./chunk-OBGG7FEQ.js";import{Ia as h,Jc as p,Kc as w,S as f,Y as c,dd as I,e as T,f as a,kd as l,ld as u}from"./chunk-4V4LRF2E.js";var n=T(k());var R=(()=>{class s{constructor(){this.user=h(null),this._firestore=c(I),this._router=c(g)}login(r,t){return a(this,null,function*(){let o=w();return yield p(o,r,t).then(e=>a(this,null,function*(){try{let i={email:e.user.email,uid:e.user.uid,role:""},v=yield e.user.getIdToken();localStorage.setItem("accessToken",v);let m=l(this._firestore,`employees/${i.uid}`);if(!m)return n.default.fire({icon:"error",title:"Inicio de sesi\xF3n incorrecto",text:"Usuario o contrase\xF1a incorrectos",showConfirmButton:!1,timer:1500}),!1;let d=yield u(m);return this.user.set({email:i.email,name:d.get("name"),role:d.get("role")}),n.default.fire({icon:"success",title:"Inicio de sesi\xF3n correcto",text:"Bienvenido",showConfirmButton:!1,timer:1500}),yield new Promise(y=>setTimeout(y,1e3)),this.user()?.role==="ADMIN"||this.user()?.role==="TI"?this._router.navigate(["/admin"]):this._router.navigate(["/orders-waiter"]),!0}catch(i){return console.error("Error getting user data:",i),n.default.fire({icon:"error",title:"Inicio de sesi\xF3n incorrecto",text:"Usuario o contrase\xF1a incorrectos",showConfirmButton:!1,timer:1500}),!1}})).catch(e=>(console.error("Authentication failed:",e),n.default.fire({icon:"error",title:"Inicio de sesi\xF3n incorrecto",text:"Usuario o contrase\xF1a incorrectos",showConfirmButton:!1,timer:1500}),!1))})}logout(){this.user.set(null),localStorage.removeItem("accessToken"),this._router.navigate(["/login"])}getRole(){return this.user()?.role}getNavItems(){return this.getRole()==="ADMIN"||this.getRole()==="TI"?[{name:"Pedidos",route:"orders-waiter",icon:"pi-list"},{name:"Productos",route:"products",icon:"pi-box"},{name:"Usuarios",route:"employees",icon:"pi-user"}]:this.getRole()==="CAJA"?[{name:"Pedidos",route:"orders-waiter",icon:"pi-list"},{name:"Productos",route:"products",icon:"pi-box"}]:[{name:"Pedidos",route:"orders-waiter",icon:"pi-list"}]}validateToken(r){return a(this,null,function*(){let t=this.decodeToken(r);if(!t)return localStorage.removeItem("accessToken"),this._router.navigate(["/login"]),!1;let o=yield l(this._firestore,`employees/${t.user_id}`);if(!o)return localStorage.removeItem("accessToken"),this._router.navigate(["/login"]),!1;let e=yield u(o);return this.user.set({email:t.email,name:e.get("name"),role:e.get("role")}),!0})}decodeToken(r){var t=r.split(".")[1],o=t.replace(/-/g,"+").replace(/_/g,"/"),e=decodeURIComponent(window.atob(o).split("").map(function(i){return"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(e)}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275prov=f({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();export{R as a};
