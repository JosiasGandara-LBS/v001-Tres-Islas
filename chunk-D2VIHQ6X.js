import{a as S}from"./chunk-T4BPVZYH.js";import{$a as o,Bd as p,Cd as b,Ed as C,Gd as v,Q as I,T as g,Z as c,a as m,la as f,qc as u,va as d,zd as y}from"./chunk-V2UJK3JJ.js";function l(n,a){let r=!a?.manualCleanup;r&&!a?.injector&&f(l);let t=r?a?.injector?.get(d)??c(d):null,e;a?.requireSync?e=o({kind:0}):e=o({kind:1,value:a?.initialValue});let s=n.subscribe({next:i=>e.set({kind:1,value:i}),error:i=>{if(a?.rejectErrors)throw i;e.set({kind:2,error:i})}});return t?.onDestroy(s.unsubscribe.bind(s)),u(()=>{let i=e();switch(i.kind){case 1:return i.value;case 2:throw i.error;case 0:throw new I(601,"`toSignal()` called with `requireSync` but `Observable` did not emit synchronously.")}})}var _=(()=>{class n{constructor(){this._firestore=c(y),this._storage=c(S),this._collectionMenu=C(this._firestore,"menu"),this.cartItemsCount=o(0),this.totalPrice=o(0),this.cartItems=o([]),this.getMenu=l(p(this._collectionMenu,{idField:"id"}),{initialValue:[]}),this.cartItems.set(this.getCartItems()),this.cartItemsCount.set(this.getTotalItems()),this.totalPrice.set(this.getTotalPrice())}get cartItemsValue(){return this.cartItems()}getCartItemsCount(){return u(()=>this.cartItemsCount())}getTotalPriceSignal(){return u(()=>this.totalPrice())}getItemById(r){let t=v(this._firestore,`menu/${r}`);return b(t,{idField:"id"})}getTotalItems(){return this.getCartItems().reduce((t,e)=>t+e.quantity,0)}getTotalPrice(){return this.getCartItems().reduce((t,e)=>t+e.price*e.quantity,0)}getCartItems(){let r=localStorage.getItem("cart");return r?JSON.parse(r):[]}getCartItemById(r){return this.getCartItems().find(e=>e.id===r)}getCartItemsToOrder(){return JSON.parse(localStorage.getItem("cart")||"[]").map(t=>({id:t.id,name:t.name,quantity:t.quantity,category:t.category,price:t.price,additionalInstructions:t.additionalInstructions}))}getQuantity(r){return this.getCartItems().filter(e=>e.id===r).reduce((e,s)=>e+s.quantity,0)}saveCartItems(r){localStorage.setItem("cart",JSON.stringify(r)),this.cartItems.set(r),this.cartItemsCount.set(this.getTotalItems()),this.totalPrice.set(this.getTotalPrice())}addToCart(r,t,e,s,i,w,x){let h=[...this.cartItems()];h.push({id:r,name:t,description:e,category:s,price:i,image:"",quantity:w,additionalInstructions:x}),this.saveCartItems(h)}updateCartItemsWithImage(){let r=this.getMenu(),t=this.cartItemsValue;t.forEach(e=>{let s=r.find(i=>i.id===e.id);s&&(e.image=s.image)}),this.saveCartItems(t)}updateCartItem(r){let t=this.getCartItems(),e=t.findIndex(s=>s.id===r.id);e!==-1&&(t[e]=m(m({},t[e]),r),this.saveCartItems(t))}deleteCartItem(r){let t=this.getCartItems(),e=t.findIndex(s=>s.id===r);e!==-1&&(t.splice(e,1),this.saveCartItems(t))}clearCart(){localStorage.removeItem("cart"),this.cartItems.set([]),this.cartItemsCount.set(0),this.totalPrice.set(0)}incrementQuantity(r){let t=this.getCartItems(),e=t.find(s=>s.id===r);e&&(e.quantity+=1,this.saveCartItems(t))}decrementQuantity(r){let t=this.getCartItems(),e=t.find(s=>s.id===r);if(e){if(e.quantity=Math.max(0,e.quantity-1),e.quantity===0){let s=t.indexOf(e);s>-1&&t.splice(s,1)}this.saveCartItems(t)}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=g({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();export{_ as a};
