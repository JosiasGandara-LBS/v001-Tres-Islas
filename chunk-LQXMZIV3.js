import{b as le,c as ae}from"./chunk-5KBS2D2T.js";import{c as me,d as pe,e as de,f as ce}from"./chunk-FHQ7LA6I.js";import{l as se}from"./chunk-HLTDMB4U.js";import{a as oe}from"./chunk-YCORS3AZ.js";import{b as U,c as C,e as N,f as k,j as A,m as j,n as D,q as V,s as P}from"./chunk-S34QQD2E.js";import{i as ie,u as re,v as ne}from"./chunk-MZTEZJ2M.js";import{$a as v,Ia as f,Oa as y,Qa as m,S as z,Ta as E,Tb as b,Vc as W,Y as c,Za as n,_a as i,a as S,aa as F,cd as X,db as J,e as L,eb as x,ed as Y,fb as u,fc as K,hd as Z,jd as ee,ka as G,la as O,nc as I,ob as a,od as te,pb as M,qb as _,qc as Q,wb as T,xb as h,ya as l,za as H}from"./chunk-3MM7HPS6.js";var fe=L(oe());var q=()=>({"border-width":"1px"});function ge(t,d){if(t&1&&(n(0,"div",14),a(1),i()),t&2){let e=u();l(),_(" ",e.getErrorMessage("name")," ")}}function Ee(t,d){if(t&1&&(n(0,"div",14),a(1),i()),t&2){let e=u();l(),_(" ",e.getErrorMessage("role")," ")}}function ve(t,d){if(t&1&&(n(0,"div",14),a(1),i()),t&2){let e=u(2);l(),_(" ",e.getErrorMessage("email")," ")}}function xe(t,d){if(t&1&&(n(0,"div",3)(1,"label",15),a(2,"Email"),i(),v(3,"input",16),y(4,ve,2,1,"div",6),i()),t&2){let e,o=u();l(3),E(h(3,q)),l(),m("ngIf",((e=o.employeeForm.get("email"))==null?null:e.invalid)&&((e=o.employeeForm.get("email"))==null?null:e.touched))}}function _e(t,d){if(t&1&&(n(0,"div",14),a(1),i()),t&2){let e=u(2);l(),_(" ",e.getErrorMessage("password")," ")}}function be(t,d){if(t&1&&(n(0,"div",3)(1,"label",17),a(2,"Contrase\xF1a"),i(),v(3,"input",18),y(4,_e,2,1,"div",6),i()),t&2){let e,o=u();l(3),E(h(3,q)),l(),m("ngIf",((e=o.employeeForm.get("password"))==null?null:e.invalid)&&((e=o.employeeForm.get("password"))==null?null:e.touched))}}var R=(()=>{class t{constructor(e){this.fb=e,this.roles=[{name:"ADMIN"},{name:"TI"},{name:"CAJA"},{name:"MESERO"}],this.empService=c(B),this._selectedUser=f(null),this.selectedUser=b(()=>this._selectedUser()),this.employeeForm=this.fb.group({name:["",C.required],email:["",[C.required,C.email]],role:["",C.required],password:[""]})}ngOnInit(){this.empService.selectedUser()&&(this._selectedUser.set(this.empService.selectedUser()),this.employeeForm.patchValue(S({},this.empService.selectedUser())))}getErrorMessage(e){let o=this.employeeForm.get(e);return o?.hasError("required")?"Este campo es requerido":e==="email"&&o?.hasError("email")?"Email no v\xE1lido":""}saveEmployee(){if(this.employeeForm.valid){if(this.empService.selectedUser())this.empService.updateEmployee(this.employeeForm.value);else{if(!this.employeeForm.get("password")?.value){fe.default.fire({icon:"error",title:"Error",text:"La contrase\xF1a es requerida"});return}this.empService.addEmployee(this.employeeForm.value,this.employeeForm.get("password")?.value)}this.empService.closeModal()}}closeModal(){this.empService.closeModal()}static{this.\u0275fac=function(o){return new(o||t)(H(V))}}static{this.\u0275cmp=F({type:t,selectors:[["app-employee-modal"]],standalone:!0,features:[T],decls:21,vars:12,consts:[[1,"custom-dialog","w-full","py-4","h-full","nunito-regular","flex","flex-col","justify-between"],[1,"p-fluid","flex","flex-col","gap-5",3,"formGroup"],[1,"grid","w-full","gap-4"],[1,"p-field","col-span-6","flex","flex-col"],["for","employeeName"],["id","employeeName","type","text","pInputText","","formControlName","name",1,"border-c-gray-100","rounded-md","py-2","px-1","focus:border-orange-500","focus:shadow-md","focus:shadow-orange-300","focus:outline-none","focus:ring-0","outline-none"],["class","p-error",4,"ngIf"],["for","employeeRole"],["formControlName","role","optionLabel","name","optionValue","name","styleClass","border-c-gray-100 rounded-md focus:border-orange-500 focus:shadow-md focus:shadow-orange-300 focus:outline-none focus:ring-0 outline-none",3,"options"],["class","p-field col-span-6 flex flex-col",4,"ngIf"],[1,"ui-dialog-footer"],[1,"flex","justify-end","gap-4","mt-8","mb-3"],[1,"bg-red-500","text-white","px-4","py-2","rounded-md",3,"click"],[1,"bg-green-500","text-white","px-4","py-2","rounded-md",3,"click"],[1,"p-error"],["for","employeeEmail"],["id","employeeEmail","type","email","pInputText","","formControlName","email",1,"border-c-gray-100","rounded-md","py-2","px-1","focus:border-orange-500","focus:shadow-md","focus:shadow-orange-300","focus:outline-none","focus:ring-0","outline-none"],["for","employeePassword"],["id","employeePassword","type","password","pInputText","","formControlName","password",1,"border-c-gray-100","rounded-md","py-2","px-1","focus:border-orange-500","focus:shadow-md","focus:shadow-orange-300","focus:outline-none","focus:ring-0","outline-none"]],template:function(o,r){if(o&1&&(n(0,"div",0)(1,"form",1)(2,"div",2)(3,"div",3)(4,"label",4),a(5,"Nombre"),i(),v(6,"input",5),y(7,ge,2,1,"div",6),i(),n(8,"div",3)(9,"label",7),a(10,"Rol"),i(),v(11,"p-dropdown",8),y(12,Ee,2,1,"div",6),i(),y(13,xe,5,4,"div",9)(14,be,5,4,"div",9),i()(),n(15,"div",10)(16,"div",11)(17,"button",12),x("click",function(){return r.closeModal()}),a(18,"Cancelar"),i(),n(19,"button",13),x("click",function(){return r.saveEmployee()}),a(20,"Guardar"),i()()()()),o&2){let s,p;l(),m("formGroup",r.employeeForm),l(5),E(h(10,q)),l(),m("ngIf",((s=r.employeeForm.get("name"))==null?null:s.invalid)&&((s=r.employeeForm.get("name"))==null?null:s.touched)),l(4),E(h(11,q)),m("options",r.roles),l(),m("ngIf",((p=r.employeeForm.get("role"))==null?null:p.invalid)&&((p=r.employeeForm.get("role"))==null?null:p.touched)),l(),m("ngIf",!r.selectedUser()),l(),m("ngIf",!r.selectedUser())}},dependencies:[I,K,pe,me,P,A,U,N,k,j,D]})}}return t})();var g=L(oe());var B=(()=>{class t{constructor(){this.dialogService=c(se),this.auth=c(W),this.firestore=c(X),this.http=c(Q),this.selectedUser=f(null)}getEmployees(){return Y(Z(this.firestore,"employees"),{idField:"id"})}openAddEmployeeModal(){this.ref=this.dialogService.open(R,{header:"Agregar usuario",modal:!0,keepInViewport:!0,width:"80%",style:{"max-height":"80%",height:"auto"},contentStyle:{overflow:"auto"}})}openEditEmployeeModal(){this.ref=this.dialogService.open(R,{header:"Editar usuario",modal:!0,keepInViewport:!0,width:"80%",style:{"max-height":"80%",height:"auto"},contentStyle:{overflow:"auto"}}),this.ref.onClose.subscribe(e=>{this.selectedUser.set(null)})}closeModal(){this.ref.close()}deleteUserFromFirebaseAuth(e){let o=ae,r={uid:e},s=this.http.post(o,r).subscribe(p=>{console.log(p),p&&g.default.fire("\xC9xito","Empleado eliminado correctamente","success"),s.unsubscribe()},p=>{g.default.fire("Error",`Ocurri\xF3 un error al eliminar el empleado: ${p.error.error}`,"error"),s.unsubscribe()})}createUserFirebaseAuth(e,o,r,s){let p=le,ye={email:e,password:o,role:r,name:s},$=this.http.post(p,ye).subscribe(w=>{console.log(w),w&&g.default.fire("\xC9xito","Empleado agregado correctamente","success"),$.unsubscribe()},w=>{g.default.fire("Error",`Ocurri\xF3 un error al agregar el empleado: ${w.error.error}`,"error"),$.unsubscribe()})}deleteEmployee(e){g.default.fire({title:`\xBFEst\xE1s seguro de eliminar el empleado ${e.name}?`,text:"No podr\xE1s revertir esta acci\xF3n",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"S\xED, eliminar",cancelButtonText:"Cancelar"}).then(o=>{if(o.isConfirmed)try{this.deleteUserFromFirebaseAuth(e.id)}catch{g.default.fire("Error","Ocurri\xF3 un error al eliminar el empleado","error")}})}addEmployee(e,o){try{this.createUserFirebaseAuth(e.email,o,e.role,e.name)}catch{g.default.fire("Error","Ocurri\xF3 un error al agregar el empleado","error")}}updateEmployee(e){let o=ee(this.firestore,"employees",e.id);return te(o,S({},e))}static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var Ce=()=>({"border-width":"1px"}),we=()=>[5,10,20];function Se(t,d){t&1&&(n(0,"div",10),a(1," Empleados "),i())}function Fe(t,d){t&1&&(n(0,"tr")(1,"th",11),a(2,"Email"),i(),n(3,"th",11),a(4,"Nombre"),i(),n(5,"th",11),a(6,"Rol"),i(),n(7,"th",11),a(8,"Acciones"),i()())}function Me(t,d){if(t&1){let e=J();n(0,"tr")(1,"td",11),a(2),i(),n(3,"td",11),a(4),i(),n(5,"td",11),a(6),i(),n(7,"td")(8,"div",12)(9,"p-button",13),x("onClick",function(){let r=G(e).$implicit,s=u();return O(s.openEditEmployeeModal(r))}),i(),n(10,"p-button",14),x("onClick",function(){let r=G(e).$implicit,s=u();return O(s.deleteEmployee(r))}),i()()()()}if(t&2){let e=d.$implicit;l(2),M(e.email),l(2),M(e.name),l(2),M(e.role)}}function Te(t,d){t&1&&(n(0,"div",15)(1,"div",16),a(2,"No se encontraron empleados"),i()())}var nt=(()=>{class t{constructor(){this.empService=c(B),this.fb=c(V),this._employees=f([]),this.employees=b(()=>this._employees()),this.filteredEmployees=f([]),this._selectedEmployee=f(null),this.selectedEmployee=b(()=>this._selectedEmployee()),this.loadingEmployees=f(!1),this.searchForm=this.fb.group({query:[""]})}ngOnInit(){this.getEmployees(),this.searchForm.get("query")?.valueChanges.subscribe(e=>{this.filterEmployees(e)})}getEmployees(){this.loadingEmployees.set(!0),this.empService.getEmployees().subscribe(e=>{this._employees.set(e),this.filteredEmployees.set(e)}),this.loadingEmployees.set(!1)}filterEmployees(e){let o=this.employees().filter(r=>r.name.toLowerCase().includes(e.toLowerCase()));this.filteredEmployees.set(o)}openAddEmployeeModal(){this.empService.openAddEmployeeModal()}openEditEmployeeModal(e){this.empService.selectedUser.set(e),this.empService.openEditEmployeeModal()}deleteEmployee(e){this.empService.deleteEmployee(e.id)}static{this.\u0275fac=function(o){return new(o||t)}}static{this.\u0275cmp=F({type:t,selectors:[["app-users"]],standalone:!0,features:[T],decls:10,vars:11,consts:[[1,"w-full","h-full","bg-white"],[1,"flex","justify-center","items-center","gap-4","p-4","sticky","top-0","bg-transparent","z-10"],["rounded","true","icon","pi pi-plus","styleClass","mb-4 bg-blue-500 text-white",3,"onClick"],[1,"w-full","h-16","flex","justify-center","items-center","py-4","my-5",3,"formGroup"],["type","text","id","query","placeholder","Buscar empleados...","pInputText","","formControlName","query",1,"w-2/3","border-c-gray-100","rounded-md","py-2","px-1","focus:border-orange-500","focus:shadow-md","focus:shadow-orange-300","focus:outline-none","focus:ring-0","outline-none"],["showPaginator","true","paginatorPosition","bottom",3,"value","paginator","rows","rowsPerPageOptions","responsive","showCurrentPageReport"],["pTemplate","caption",1,"w-full","h-auto"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage",1,"!w-full","flex","justify-center","items-center"],[1,"flex","w-full","items-center","justify-center","text-2xl"],[1,"text-center"],[1,"flex","gap-4","items-center","justify-center"],["pTooltip","Editar empleado","icon","pi pi-pencil","styleClass","bg-c-orange-100 rounded-full text-white px-4 py-3",3,"onClick"],["pTooltip","Eliminar empleado","icon","pi pi-trash","styleClass","bg-red-500 rounded-full text-white px-4 py-3",3,"onClick"],[1,"!w-full","flex","justify-center","items-center"],[1,"text-center","text-xl","!w-full","flex","align-center","justify-center"]],template:function(o,r){o&1&&(n(0,"div",0)(1,"div",1)(2,"p-button",2),x("onClick",function(){return r.openAddEmployeeModal()}),i()(),n(3,"form",3),v(4,"input",4),i(),n(5,"p-table",5),y(6,Se,2,0,"ng-template",6)(7,Fe,9,0,"ng-template",7)(8,Me,11,3,"ng-template",8)(9,Te,3,0,"ng-template",9),i()()),o&2&&(l(3),m("formGroup",r.searchForm),l(),E(h(9,Ce)),l(),m("value",r.filteredEmployees())("paginator",!0)("rows",10)("rowsPerPageOptions",h(10,we))("responsive",!0)("showCurrentPageReport",!0))},dependencies:[I,ne,re,ie,ce,de,P,A,U,N,k,j,D],encapsulation:2})}}return t})();export{nt as EmployeesComponent};
