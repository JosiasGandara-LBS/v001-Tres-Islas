import{c as g}from"./chunk-6JMVRBBA.js";import{a as T}from"./chunk-FKQ6VRYC.js";import{$a as h,Fd as l,Gd as u,T as f,Z as c,dd as p,e as k,ed as w,f as a,yd as I}from"./chunk-DGTG4CQ7.js";var n=k(T());var R=(()=>{class s{constructor(){this.user=h(null),this._firestore=c(I),this._router=c(g)}login(o,t){return a(this,null,function*(){let r=w();return yield p(r,o,t).then(e=>a(this,null,function*(){try{let i={email:e.user.email,uid:e.user.uid,role:""},v=yield e.user.getIdToken();localStorage.setItem("accessToken",v);let m=l(this._firestore,`employees/${i.uid}`);if(!m)return n.default.fire({icon:"error",title:"Inicio de sesi\xF3n incorrecto",text:"Usuario o contrase\xF1a incorrectos",showConfirmButton:!1,timer:1500}),!1;let d=yield u(m);return this.user.set({email:i.email,name:d.get("name"),role:d.get("role")}),n.default.fire({icon:"success",title:"Inicio de sesi\xF3n correcto",text:"Bienvenido",showConfirmButton:!1,timer:1500}),yield new Promise(y=>setTimeout(y,1e3)),this.user()?.role==="ADMIN"||this.user()?.role==="TI"?this._router.navigate(["/admin"]):this._router.navigate(["/orders-waiter"]),!0}catch(i){return console.error("Error getting user data:",i),n.default.fire({icon:"error",title:"Inicio de sesi\xF3n incorrecto",text:"Usuario o contrase\xF1a incorrectos",showConfirmButton:!1,timer:1500}),!1}})).catch(e=>(console.error("Authentication failed:",e),n.default.fire({icon:"error",title:"Inicio de sesi\xF3n incorrecto",text:"Usuario o contrase\xF1a incorrectos",showConfirmButton:!1,timer:1500}),!1))})}logout(){this.user.set(null),localStorage.removeItem("accessToken"),this._router.navigate(["/login"])}getRole(){return this.user()?.role}getNavItems(){return this.getRole()==="ADMIN"||this.getRole()==="TI"?[{name:"Pedidos",route:"orders-waiter",icon:"pi-list"},{name:"Productos",route:"products",icon:"pi-box"},{name:"Usuarios",route:"employees",icon:"pi-user"},{name:"Historial",route:"history",icon:"pi-clock"}]:this.getRole()==="CAJA"?[{name:"Pedidos",route:"orders-waiter",icon:"pi-list"},{name:"Productos",route:"products",icon:"pi-box"}]:[{name:"Pedidos",route:"orders-waiter",icon:"pi-list"}]}validateToken(o){return a(this,null,function*(){let t=this.decodeToken(o);if(!t)return localStorage.removeItem("accessToken"),this._router.navigate(["/login"]),!1;let r=yield l(this._firestore,`employees/${t.user_id}`);if(!r)return localStorage.removeItem("accessToken"),this._router.navigate(["/login"]),!1;let e=yield u(r);return this.user.set({email:t.email,name:e.get("name"),role:e.get("role")}),!0})}decodeToken(o){var t=o.split(".")[1],r=t.replace(/-/g,"+").replace(/_/g,"/"),e=decodeURIComponent(window.atob(r).split("").map(function(i){return"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(e)}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275prov=f({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();export{R as a};
